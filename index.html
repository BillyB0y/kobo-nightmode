<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>kobo-nightmode by dbeinder</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>kobo-nightmode</h1>
        <h2>White-on-black mode for Kobo ebook readers. Works only on the eInk series!</h2>
        <a href="https://github.com/dbeinder/kobo-nightmode" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="kobo-nightmode" class="anchor" href="#kobo-nightmode"><span class="octicon octicon-link"></span></a>kobo-nightmode</h1>

<p>A tiny hack to read white-on-black on Kobo ebook readers. Works only on the eInk series:</p>

<ul>
<li>Kobo Glo</li>
<li>Kobo Touch</li>
<li>Kobo Aura HD</li>
<li>Kobo Mini</li>
</ul><p>Since the update to firmware 2.6+ Kobo has moved to hardware float proccessing, 
requiring a new toolchain and partly breaking binary compatibility with older software. Currently this hack still works on  firmwares below 2.6, but it is highly recommended to upgrade.
If you need help or find a bug, check the <a href="http://www.mobileread.com/forums/showthread.php?t=212162">mobileread thread</a>, or create an issue on github.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>There are two ways to contol nightmode:</p>

<ul>
<li>Long-press the LIGHT / HOME button on your device to toggle</li>
<li>Write into the <code>/tmp/invertScreen</code> fifo-interface

<ul>
<li>Send <code>y</code> to set nightmode to ON</li>
<li>Send <code>n</code> to set nightmode to OFF</li>
<li>Send <code>t</code> to toggle</li>
</ul>
</li>
</ul><p>A sample script to toggle is provided in <code>extra/nightmode.sh</code>.
As the Kobo Mini has no physical buttons, the fifo-interface is currently the only way to control nightmode when running and thus, 
relies on external tools such as:</p>

<ul>
<li>
<a href="http://www.mobileread.com/forums/showthread.php?t=206180">Kobo Tweaks</a>, maintained by ah- (currently not available for 2.6+)</li>
<li>
<a href="http://www.mobileread.com/forums/showthread.php?t=201632">KoboLauncher</a>, maintained by sergeyvl12</li>
</ul><h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>The configuration file called <code>nightmode.ini</code> is located in your <code>.kobo</code> folder:</p>

<div class="highlight"><pre><span class="c1"># config file for kobo-nightmode</span>

<span class="k">[state]</span>
<span class="na">invertActiveOnStartup</span> <span class="o">=</span> <span class="s">no      # yes / no</span>
<span class="na">retainStateOverRestart</span> <span class="o">=</span> <span class="s">yes    # yes / no</span>

<span class="k">[control]</span>
<span class="na">longPressDurationMS</span> <span class="o">=</span> <span class="s">800       # time in milliseconds to toggle (1000 = 1 second)</span>
</pre></div>

<p>If <code>retainStateOverRestart</code> is activated, the value of <code>invertActiveOnStartup</code> will modified to reflect the current state.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>In the installer/uninstaller directories, two <code>KoboRoot.tgz</code> files are provided for automatic installation and removal.
Simply copy one of them into the .kobo folder on your device, safely remove, and wait for the reboot to finish.</p>

<h2>
<a name="how-it-works" class="anchor" href="#how-it-works"><span class="octicon octicon-link"></span></a>How it works</h2>

<p>This hack works by intercepting and modifying screen-update requests on-the-fly from the main reader application. 
This is accomplished by interposing the <code>ioctl()</code> function using LD_PRELOAD.
Therefore <code>/etc/init.d/rcS</code> has to be modified to start <code>nickel</code>, the main app with the <code>screenInv.so</code> dynamic library.</p>

<h2>
<a name="compile-for-yourself" class="anchor" href="#compile-for-yourself"><span class="octicon octicon-link"></span></a>Compile for yourself</h2>

<p>All you need can be found in Kobo's <a href="https://github.com/kobolabs/Kobo-Reader">Kobo-Reader</a> repository:</p>

<ul>
<li>An linux tarball for the imx507 platform</li>
<li>The gcc-linaro-arm-linux-gnueabihf toolchain to compile</li>
</ul><h2>
<a name="credits" class="anchor" href="#credits"><span class="octicon octicon-link"></span></a>Credits</h2>

<ul>
<li>Nicolas Devillard and others, for the <a href="http://github.com/ndevilla/iniparser">iniParser</a> library</li>
</ul>
        </section>

        <aside id="sidebar">
          <h2 class="version">Latest version: <span>build 7</span></h2>
          <a href="https://github.com/dbeinder/kobo-nightmode/raw/master/kobo-nightmode_build7.zip" class="button sprite">
              <small>Download</small> Installer
          </a>
          <a href="https://github.com/dbeinder/kobo-nightmode/zipball/master" class="button">
            <small>Download source</small>
            .zip file
          </a>
          <a href="https://github.com/dbeinder/kobo-nightmode/tarball/master" class="button">
            <small>Download source</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/dbeinder/kobo-nightmode"></a> is maintained by <a href="https://github.com/dbeinder">dbeinder</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
